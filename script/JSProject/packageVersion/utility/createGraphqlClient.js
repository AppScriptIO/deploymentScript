"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.createGraphqlClient = createGraphqlClient;
var _apolloCacheInmemory = require("apollo-cache-inmemory");
var _apolloLinkHttp = require("apollo-link-http");
var _apolloClient = require("apollo-client");
var _apolloLinkError = require("apollo-link-error");
var _apolloLink = require("apollo-link");
var _nodeFetch = _interopRequireDefault(require("node-fetch"));

function createGraphqlClient({ endpoint, token }) {

  const defaultOptions = {
    watchQuery: {
      fetchPolicy: 'no-cache',
      errorPolicy: 'ignore' },

    query: {
      fetchPolicy: 'no-cache',
      errorPolicy: 'all' } };




  const errorMiddleware = (0, _apolloLinkError.onError)(({ graphQLErrors, networkError }) => {
    let formatedErrorMessage = [];
    if (graphQLErrors) {
      formatedErrorMessage = graphQLErrors.map(({ message, locations, path }) => {
        return `Message: ${message}, Location: ${locations}, Path: ${path} \n`;
      });
      console.error(`‚ùå  GraphQl 'errors' property:`);
      console.dir(formatedErrorMessage);
      throw new Error(`[GraphQL error]: An error received from the response of the GraphQL API.`);
    }

    if (networkError) throw new Error(`[Network error]: ${networkError}`);
  });

  const httpMiddleware = new _apolloLinkHttp.HttpLink({
    fetch: _nodeFetch.default,
    uri: endpoint,
    headers: {
      Authorization: `bearer ${token}` } });




  const combinedLink = _apolloLink.ApolloLink.from([
  errorMiddleware,
  httpMiddleware]);


  return new _apolloClient.ApolloClient({
    link: combinedLink,
    cache: new _apolloCacheInmemory.InMemoryCache(),
    defaultOptions });

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NjcmlwdC9KU1Byb2plY3QvcGFja2FnZVZlcnNpb24vdXRpbGl0eS9jcmVhdGVHcmFwaHFsQ2xpZW50LmpzIl0sIm5hbWVzIjpbImNyZWF0ZUdyYXBocWxDbGllbnQiLCJlbmRwb2ludCIsInRva2VuIiwiZGVmYXVsdE9wdGlvbnMiLCJ3YXRjaFF1ZXJ5IiwiZmV0Y2hQb2xpY3kiLCJlcnJvclBvbGljeSIsInF1ZXJ5IiwiZXJyb3JNaWRkbGV3YXJlIiwiZ3JhcGhRTEVycm9ycyIsIm5ldHdvcmtFcnJvciIsImZvcm1hdGVkRXJyb3JNZXNzYWdlIiwibWFwIiwibWVzc2FnZSIsImxvY2F0aW9ucyIsInBhdGgiLCJjb25zb2xlIiwiZXJyb3IiLCJkaXIiLCJFcnJvciIsImh0dHBNaWRkbGV3YXJlIiwiSHR0cExpbmsiLCJmZXRjaCIsIm5vZGVGZXRjaCIsInVyaSIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiY29tYmluZWRMaW5rIiwiQXBvbGxvTGluayIsImZyb20iLCJBcG9sbG9DbGllbnQiLCJsaW5rIiwiY2FjaGUiLCJJbk1lbW9yeUNhY2hlIl0sIm1hcHBpbmdzIjoiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVPLFNBQVNBLG1CQUFULENBQTZCLEVBQUVDLFFBQUYsRUFBWUMsS0FBWixFQUE3QixFQUFrRDs7QUFFdkQsUUFBTUMsY0FBYyxHQUFHO0FBQ3JCQyxJQUFBQSxVQUFVLEVBQUU7QUFDVkMsTUFBQUEsV0FBVyxFQUFFLFVBREg7QUFFVkMsTUFBQUEsV0FBVyxFQUFFLFFBRkgsRUFEUzs7QUFLckJDLElBQUFBLEtBQUssRUFBRTtBQUNMRixNQUFBQSxXQUFXLEVBQUUsVUFEUjtBQUVMQyxNQUFBQSxXQUFXLEVBQUUsS0FGUixFQUxjLEVBQXZCOzs7OztBQVlBLFFBQU1FLGVBQWUsR0FBRyw4QkFBUSxDQUFDLEVBQUVDLGFBQUYsRUFBaUJDLFlBQWpCLEVBQUQsS0FBcUM7QUFDbkUsUUFBSUMsb0JBQW9CLEdBQUcsRUFBM0I7QUFDQSxRQUFJRixhQUFKLEVBQW1CO0FBQ2pCRSxNQUFBQSxvQkFBb0IsR0FBR0YsYUFBYSxDQUFDRyxHQUFkLENBQWtCLENBQUMsRUFBRUMsT0FBRixFQUFXQyxTQUFYLEVBQXNCQyxJQUF0QixFQUFELEtBQWtDO0FBQ3pFLGVBQVEsWUFBV0YsT0FBUSxlQUFjQyxTQUFVLFdBQVVDLElBQUssS0FBbEU7QUFDRCxPQUZzQixDQUF2QjtBQUdBQyxNQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBZSwrQkFBZjtBQUNBRCxNQUFBQSxPQUFPLENBQUNFLEdBQVIsQ0FBWVAsb0JBQVo7QUFDQSxZQUFNLElBQUlRLEtBQUosQ0FBVywwRUFBWCxDQUFOO0FBQ0Q7O0FBRUQsUUFBSVQsWUFBSixFQUFrQixNQUFNLElBQUlTLEtBQUosQ0FBVyxvQkFBbUJULFlBQWEsRUFBM0MsQ0FBTjtBQUNuQixHQVp1QixDQUF4Qjs7QUFjQSxRQUFNVSxjQUFjLEdBQUcsSUFBSUMsd0JBQUosQ0FBYTtBQUNsQ0MsSUFBQUEsS0FBSyxFQUFFQyxrQkFEMkI7QUFFbENDLElBQUFBLEdBQUcsRUFBRXZCLFFBRjZCO0FBR2xDd0IsSUFBQUEsT0FBTyxFQUFFO0FBQ1BDLE1BQUFBLGFBQWEsRUFBRyxVQUFTeEIsS0FBTSxFQUR4QixFQUh5QixFQUFiLENBQXZCOzs7OztBQVNBLFFBQU15QixZQUFZLEdBQUdDLHVCQUFXQyxJQUFYLENBQWdCO0FBQ25DckIsRUFBQUEsZUFEbUM7QUFFbkNZLEVBQUFBLGNBRm1DLENBQWhCLENBQXJCOzs7QUFLQSxTQUFPLElBQUlVLDBCQUFKLENBQWlCO0FBQ3RCQyxJQUFBQSxJQUFJLEVBQUVKLFlBRGdCO0FBRXRCSyxJQUFBQSxLQUFLLEVBQUUsSUFBSUMsa0NBQUosRUFGZTtBQUd0QjlCLElBQUFBLGNBSHNCLEVBQWpCLENBQVA7O0FBS0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdXRpbCBmcm9tICd1dGlsJ1xuaW1wb3J0IHsgSW5NZW1vcnlDYWNoZSB9IGZyb20gJ2Fwb2xsby1jYWNoZS1pbm1lbW9yeSdcbmltcG9ydCB7IEh0dHBMaW5rIH0gZnJvbSAnYXBvbGxvLWxpbmstaHR0cCdcbmltcG9ydCB7IEFwb2xsb0NsaWVudCB9IGZyb20gJ2Fwb2xsby1jbGllbnQnXG5pbXBvcnQgeyBvbkVycm9yIH0gZnJvbSAnYXBvbGxvLWxpbmstZXJyb3InXG5pbXBvcnQgeyBBcG9sbG9MaW5rIH0gZnJvbSAnYXBvbGxvLWxpbmsnXG5pbXBvcnQgbm9kZUZldGNoIGZyb20gJ25vZGUtZmV0Y2gnXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVHcmFwaHFsQ2xpZW50KHsgZW5kcG9pbnQsIHRva2VuIH0pIHtcbiAgLy8gcmVmZXJlbmNlOiBodHRwczovL3d3dy5hcG9sbG9ncmFwaHFsLmNvbS9kb2NzL3JlYWN0L2FwaS9hcG9sbG8tY2xpZW50Lmh0bWwjYXBvbGxvLWNsaWVudFxuICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICB3YXRjaFF1ZXJ5OiB7XG4gICAgICBmZXRjaFBvbGljeTogJ25vLWNhY2hlJyxcbiAgICAgIGVycm9yUG9saWN5OiAnaWdub3JlJyxcbiAgICB9LFxuICAgIHF1ZXJ5OiB7XG4gICAgICBmZXRjaFBvbGljeTogJ25vLWNhY2hlJyxcbiAgICAgIGVycm9yUG9saWN5OiAnYWxsJyxcbiAgICB9LFxuICB9XG5cbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Fwb2xsb2dyYXBocWwvYXBvbGxvLWNsaWVudC9ibG9iL21hc3Rlci9kb2NzL3NvdXJjZS9mZWF0dXJlcy9lcnJvci1oYW5kbGluZy5tZCN1c2FnZVxuICBjb25zdCBlcnJvck1pZGRsZXdhcmUgPSBvbkVycm9yKCh7IGdyYXBoUUxFcnJvcnMsIG5ldHdvcmtFcnJvciB9KSA9PiB7XG4gICAgbGV0IGZvcm1hdGVkRXJyb3JNZXNzYWdlID0gW11cbiAgICBpZiAoZ3JhcGhRTEVycm9ycykge1xuICAgICAgZm9ybWF0ZWRFcnJvck1lc3NhZ2UgPSBncmFwaFFMRXJyb3JzLm1hcCgoeyBtZXNzYWdlLCBsb2NhdGlvbnMsIHBhdGggfSkgPT4ge1xuICAgICAgICByZXR1cm4gYE1lc3NhZ2U6ICR7bWVzc2FnZX0sIExvY2F0aW9uOiAke2xvY2F0aW9uc30sIFBhdGg6ICR7cGF0aH0gXFxuYFxuICAgICAgfSlcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCAgR3JhcGhRbCAnZXJyb3JzJyBwcm9wZXJ0eTpgKVxuICAgICAgY29uc29sZS5kaXIoZm9ybWF0ZWRFcnJvck1lc3NhZ2UpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFtHcmFwaFFMIGVycm9yXTogQW4gZXJyb3IgcmVjZWl2ZWQgZnJvbSB0aGUgcmVzcG9uc2Ugb2YgdGhlIEdyYXBoUUwgQVBJLmApXG4gICAgfVxuXG4gICAgaWYgKG5ldHdvcmtFcnJvcikgdGhyb3cgbmV3IEVycm9yKGBbTmV0d29yayBlcnJvcl06ICR7bmV0d29ya0Vycm9yfWApXG4gIH0pXG5cbiAgY29uc3QgaHR0cE1pZGRsZXdhcmUgPSBuZXcgSHR0cExpbmsoe1xuICAgIGZldGNoOiBub2RlRmV0Y2gsXG4gICAgdXJpOiBlbmRwb2ludCxcbiAgICBoZWFkZXJzOiB7XG4gICAgICBBdXRob3JpemF0aW9uOiBgYmVhcmVyICR7dG9rZW59YCxcbiAgICB9LFxuICB9KVxuXG4gIC8vIGNvbWJpbmUgYXBvbGxvIGBsaW5rc2AgdG8gYWxsb3cgZm9yIGVycm9yIGhhbmRsaW5nIHRoYXQgaW5jbHVkZXMgR3JhcGhRTCByZXNwb25zZSBlcnJvcnMuXG4gIGNvbnN0IGNvbWJpbmVkTGluayA9IEFwb2xsb0xpbmsuZnJvbShbXG4gICAgZXJyb3JNaWRkbGV3YXJlLFxuICAgIGh0dHBNaWRkbGV3YXJlLCAvLyBBcyBkZWZpbmVkIGJ5IGFwb2xsbyAtIHRoaXMgaXMgY29uc2lkZXJlZCBhIHRlcm1pbmF0ZWQgbGluayB0aGF0IHNob3VsZCBiZSBjb25jYXRlbmF0ZWQgYXQgbGFzdC5cbiAgXSlcblxuICByZXR1cm4gbmV3IEFwb2xsb0NsaWVudCh7XG4gICAgbGluazogY29tYmluZWRMaW5rLFxuICAgIGNhY2hlOiBuZXcgSW5NZW1vcnlDYWNoZSgpLFxuICAgIGRlZmF1bHRPcHRpb25zLFxuICB9KVxufVxuIl19