"use strict";var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.loadGraphDataFromFile = loadGraphDataFromFile;exports.exportAllGraphData = exportAllGraphData;exports.exportSubgraphData = exportSubgraphData;exports.exportSpecificGraphData = exportSpecificGraphData;exports.fixJSONData = fixJSONData;exports.clearDatabase = clearDatabase;

var _path = _interopRequireDefault(require("path"));
var _assert = _interopRequireDefault(require("assert"));
var _fs = require("fs");

var _graphTraversal = require("@dependency/graphTraversal");
var implementation = _interopRequireWildcard(require("@dependency/graphTraversal-implementation"));

const uuidv4 = require('uuid/v4');


function removeArrayDuplicateObjectByIdentity(array) {
  let unique = [];
  array.forEach(item => {
    if (!unique.some(i => i.identity == item.identity)) unique.push(item);
  });
  return unique;
}

async function loadGraphDataFromFile({ api, shouldClearDatabase = false, graphDataFilePath, url = { protocol: 'bolt', hostname: 'localhost', port: 7687 } } = {}) {
  let concreteDatabaseBehavior = new _graphTraversal.Database.clientInterface({
    implementationList: { boltCypherModelAdapter: implementation.database.boltCypherModelAdapterFunction({ url }) },
    defaultImplementation: 'boltCypherModelAdapter' });

  let concereteDatabase = concreteDatabaseBehavior[_graphTraversal.Database.$.key.getter]();

  (0, _assert.default)(graphDataFilePath, `• graphDataFilePath must be passed to script - ${graphDataFilePath}`);
  const targetProjectRootPath = api.project.configuration.configuration.directory.root;
  if (shouldClearDatabase) await clearDatabase({ concereteDatabase, url });
  let absolutePath = _path.default.isAbsolute(graphDataFilePath) ? graphDataFilePath : _path.default.join(targetProjectRootPath, graphDataFilePath);
  let graphData = require(absolutePath);
  (0, _assert.default)(Array.isArray(graphData.node) && Array.isArray(graphData.edge), `• Unsupported graph data strcuture- ${graphData.edge} - ${graphData.node}`);
  await concereteDatabase.loadGraphData({ nodeEntryData: graphData.node, connectionEntryData: graphData.edge });
  concereteDatabase.driverInstance.close();
}


async function exportAllGraphData({
  api,
  targetPath = './test/asset/',
  fileName = 'graphData.exported.json',
  url = { protocol: 'bolt', hostname: 'localhost', port: 7687 },
  fixGraphData = true } =
{}) {var _node$edge;
  let concreteDatabaseBehavior = new _graphTraversal.Database.clientInterface({
    implementationList: { boltCypherModelAdapter: implementation.database.boltCypherModelAdapterFunction({ url }) },
    defaultImplementation: 'boltCypherModelAdapter' });

  let concereteDatabase = concreteDatabaseBehavior[_graphTraversal.Database.$.key.getter]();

  const targetProjectRootPath = api.project.configuration.configuration.directory.root;
  const exportPath = _path.default.normalize(_path.default.join(targetProjectRootPath, targetPath));

  let graphData = (_node$edge = { node: await concereteDatabase.getAllNode(), edge: await concereteDatabase.getAllEdge() }, JSON.stringify(_node$edge));

  if (!(0, _fs.existsSync)(exportPath)) (0, _fs.mkdirSync)(exportPath, { recursive: true });
  await _fs.promises.writeFile(_path.default.join(exportPath, fileName), graphData, { encoding: 'utf8', flag: 'w' });
  console.log(`• Created json file - ${_path.default.join(exportPath, fileName)}`);

  if (fixGraphData) await fixJSONData({ api, targetPath, exportedFileName: fileName, targetFileName: fileName, url });

  concereteDatabase.driverInstance.close();
}


async function exportSubgraphData({
  api,
  subgraphEntryNodeKeyList = [],
  targetPath = './test/asset/',
  fileName = 'specific.exported.json',
  url = { protocol: 'bolt', hostname: 'localhost', port: 7687 },
  fixGraphData = true } =
{}) {var _node$edge2;
  let concreteDatabaseBehavior = new _graphTraversal.Database.clientInterface({
    implementationList: { boltCypherModelAdapter: implementation.database.boltCypherModelAdapterFunction({ url }) },
    defaultImplementation: 'boltCypherModelAdapter' });

  let concereteDatabase = concreteDatabaseBehavior[_graphTraversal.Database.$.key.getter]();

  const targetProjectRootPath = api.project.configuration.configuration.directory.root;
  const exportPath = _path.default.normalize(_path.default.join(targetProjectRootPath, targetPath));


  let subgraphEntryNodeIdentityList = new Set();
  for (let key of subgraphEntryNodeKeyList) subgraphEntryNodeIdentityList.add((await concereteDatabase.getNodeByKey({ key })).identity);

  let exportNodeList = new Set(),
  exportEdgeList = new Set();


  let hashTraversedNode = new Set();
  async function addRelatedNode(nodeArray) {
    for (let identity of nodeArray) {
      if (!hashTraversedNode.has(identity)) {
        hashTraversedNode.add(identity);

        let connectionArray = await concereteDatabase.getNodeConnection({ nodeID: identity });
        exportEdgeList = new Set([...exportEdgeList, ...connectionArray.map(result => result.connection.identity)]);

        let nextNodeArray = new Set(
        [...connectionArray.map(result => result.destination.identity), ...connectionArray.map(result => result.source.identity)].filter(identity => !nodeArray.has(identity)));


        await addRelatedNode(nextNodeArray);
      }
      exportNodeList.add(identity);
    }
  }

  await addRelatedNode(subgraphEntryNodeIdentityList);

  let exportNode = (await concereteDatabase.getAllNode()).filter(node => exportNodeList.has(node.identity)),
  exportEdge = (await concereteDatabase.getAllEdge()).filter(edge => exportEdgeList.has(edge.identity));

  let graphData = (_node$edge2 = { node: exportNode, edge: exportEdge }, JSON.stringify(_node$edge2));
  await _fs.promises.writeFile(_path.default.join(exportPath, fileName), graphData, { encoding: 'utf8', flag: 'w' });
  console.log(`• Created json file - ${_path.default.join(exportPath, fileName)}`);

  if (fixGraphData) await fixJSONData({ api, targetPath, exportedFileName: fileName, targetFileName: fileName, url });
  concereteDatabase.driverInstance.close();
}

async function exportSpecificGraphData({ api, targetPath = './test/asset/', fileName = 'specific.exported.json', url = { protocol: 'bolt', hostname: 'localhost', port: 7687 } } = {}) {var _node$edge3;
  let concreteDatabaseBehavior = new _graphTraversal.Database.clientInterface({
    implementationList: { boltCypherModelAdapter: implementation.database.boltCypherModelAdapterFunction({ url }) },
    defaultImplementation: 'boltCypherModelAdapter' });

  let concereteDatabase = concreteDatabaseBehavior[_graphTraversal.Database.$.key.getter]();

  const targetProjectRootPath = api.project.configuration.configuration.directory.root;
  const exportPath = _path.default.normalize(_path.default.join(targetProjectRootPath, targetPath));


  let nodeKeyArray = [];


  let nodeArray = [],
  edgeArray = [];


  for (let key of nodeKeyArray) nodeArray.push((await concereteDatabase.getNodeByKey({ key })));


  for (let node of nodeArray) {
    let queryResultArray = await concereteDatabase.getNodeConnection({ nodeID: node.identity });
    queryResultArray = queryResultArray.map(result => result.connection);
    edgeArray = [...edgeArray, ...queryResultArray];
  }


  edgeArray = edgeArray.filter(edge => nodeArray.some(node => node.identity == edge.start) && nodeArray.some(node => node.identity == edge.end));

  edgeArray = removeArrayDuplicateObjectByIdentity(edgeArray);

  let graphData = (_node$edge3 = { node: nodeArray, edge: edgeArray }, JSON.stringify(_node$edge3));
  await _fs.promises.writeFile(_path.default.join(exportPath, fileName), graphData, { encoding: 'utf8', flag: 'w' });
  console.log(`• Created json file - ${_path.default.join(exportPath, fileName)}`);
  concereteDatabase.driverInstance.close();
}




async function fixJSONData({ api, targetPath = './resource/', exportedFileName = 'fixed.exported.json', targetFileName = 'taskSequence.graphData.json' } = {}) {var _graphData;
  const targetProjectRootPath = api.project.configuration.configuration.directory.root;
  let graphData = require(_path.default.join(targetProjectRootPath, targetPath, targetFileName));


  graphData.node = graphData.node.map(item => {

    if (!item.properties.key) {
      console.log(`• Fixing node without key - ` + JSON.stringify(item));
      item.properties.key = uuidv4();
    }
    return item;
  });
  graphData.edge = graphData.edge.map(item => {

    if (!item.properties.key) {
      console.log(`• Fixing edge without key - ` + JSON.stringify(item));
      item.properties.key = uuidv4();
    }
    return item;
  });

  const exportPath = _path.default.normalize(_path.default.join(targetProjectRootPath, targetPath, exportedFileName));
  await _fs.promises.writeFile(exportPath, (_graphData = graphData, JSON.stringify(_graphData)), { encoding: 'utf8', flag: 'w' });
  console.log(`• Created json file - ${exportPath}`);
}

async function clearDatabase({ concereteDatabase, url = { protocol: 'bolt', hostname: 'localhost', port: 7687 } }) {
  if (!concereteDatabase) {
    let concreteDatabaseBehavior = new _graphTraversal.Database.clientInterface({
      implementationList: { boltCypherModelAdapter: implementation.database.boltCypherModelAdapterFunction({ url }) },
      defaultImplementation: 'boltCypherModelAdapter' });

    concereteDatabase = concreteDatabaseBehavior[_graphTraversal.Database.$.key.getter]();
  }


  const graphDBDriver = concereteDatabase.driverInstance;
  let session = await graphDBDriver.session();
  await session.run(`match (n) detach delete n`);
  console.log('• Database data cleared.');
  session.close();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS9ncmFwaERhdGFiYXNlL2dyYXBoRGF0YUxvYWRpbmcuanMiXSwibmFtZXMiOlsidXVpZHY0IiwicmVxdWlyZSIsInJlbW92ZUFycmF5RHVwbGljYXRlT2JqZWN0QnlJZGVudGl0eSIsImFycmF5IiwidW5pcXVlIiwiZm9yRWFjaCIsIml0ZW0iLCJzb21lIiwiaSIsImlkZW50aXR5IiwicHVzaCIsImxvYWRHcmFwaERhdGFGcm9tRmlsZSIsImFwaSIsInNob3VsZENsZWFyRGF0YWJhc2UiLCJncmFwaERhdGFGaWxlUGF0aCIsInVybCIsInByb3RvY29sIiwiaG9zdG5hbWUiLCJwb3J0IiwiY29uY3JldGVEYXRhYmFzZUJlaGF2aW9yIiwiRGF0YWJhc2UiLCJjbGllbnRJbnRlcmZhY2UiLCJpbXBsZW1lbnRhdGlvbkxpc3QiLCJib2x0Q3lwaGVyTW9kZWxBZGFwdGVyIiwiaW1wbGVtZW50YXRpb24iLCJkYXRhYmFzZSIsImJvbHRDeXBoZXJNb2RlbEFkYXB0ZXJGdW5jdGlvbiIsImRlZmF1bHRJbXBsZW1lbnRhdGlvbiIsImNvbmNlcmV0ZURhdGFiYXNlIiwiJCIsImtleSIsImdldHRlciIsInRhcmdldFByb2plY3RSb290UGF0aCIsInByb2plY3QiLCJjb25maWd1cmF0aW9uIiwiZGlyZWN0b3J5Iiwicm9vdCIsImNsZWFyRGF0YWJhc2UiLCJhYnNvbHV0ZVBhdGgiLCJwYXRoIiwiaXNBYnNvbHV0ZSIsImpvaW4iLCJncmFwaERhdGEiLCJBcnJheSIsImlzQXJyYXkiLCJub2RlIiwiZWRnZSIsImxvYWRHcmFwaERhdGEiLCJub2RlRW50cnlEYXRhIiwiY29ubmVjdGlvbkVudHJ5RGF0YSIsImRyaXZlckluc3RhbmNlIiwiY2xvc2UiLCJleHBvcnRBbGxHcmFwaERhdGEiLCJ0YXJnZXRQYXRoIiwiZmlsZU5hbWUiLCJmaXhHcmFwaERhdGEiLCJleHBvcnRQYXRoIiwibm9ybWFsaXplIiwiZ2V0QWxsTm9kZSIsImdldEFsbEVkZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwicmVjdXJzaXZlIiwiZmlsZXN5c3RlbSIsIndyaXRlRmlsZSIsImVuY29kaW5nIiwiZmxhZyIsImNvbnNvbGUiLCJsb2ciLCJmaXhKU09ORGF0YSIsImV4cG9ydGVkRmlsZU5hbWUiLCJ0YXJnZXRGaWxlTmFtZSIsImV4cG9ydFN1YmdyYXBoRGF0YSIsInN1YmdyYXBoRW50cnlOb2RlS2V5TGlzdCIsInN1YmdyYXBoRW50cnlOb2RlSWRlbnRpdHlMaXN0IiwiU2V0IiwiYWRkIiwiZ2V0Tm9kZUJ5S2V5IiwiZXhwb3J0Tm9kZUxpc3QiLCJleHBvcnRFZGdlTGlzdCIsImhhc2hUcmF2ZXJzZWROb2RlIiwiYWRkUmVsYXRlZE5vZGUiLCJub2RlQXJyYXkiLCJoYXMiLCJjb25uZWN0aW9uQXJyYXkiLCJnZXROb2RlQ29ubmVjdGlvbiIsIm5vZGVJRCIsIm1hcCIsInJlc3VsdCIsImNvbm5lY3Rpb24iLCJuZXh0Tm9kZUFycmF5IiwiZGVzdGluYXRpb24iLCJzb3VyY2UiLCJmaWx0ZXIiLCJleHBvcnROb2RlIiwiZXhwb3J0RWRnZSIsImV4cG9ydFNwZWNpZmljR3JhcGhEYXRhIiwibm9kZUtleUFycmF5IiwiZWRnZUFycmF5IiwicXVlcnlSZXN1bHRBcnJheSIsInN0YXJ0IiwiZW5kIiwicHJvcGVydGllcyIsImdyYXBoREJEcml2ZXIiLCJzZXNzaW9uIiwicnVuIl0sIm1hcHBpbmdzIjoiOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLE1BQU1BLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFNBQUQsQ0FBdEI7OztBQUdBLFNBQVNDLG9DQUFULENBQThDQyxLQUE5QyxFQUFxRDtBQUNuRCxNQUFJQyxNQUFNLEdBQUcsRUFBYjtBQUNBRCxFQUFBQSxLQUFLLENBQUNFLE9BQU4sQ0FBY0MsSUFBSSxJQUFJO0FBQ3BCLFFBQUksQ0FBQ0YsTUFBTSxDQUFDRyxJQUFQLENBQVlDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxRQUFGLElBQWNILElBQUksQ0FBQ0csUUFBcEMs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LE1BQUlzRCxPQUFPLEdBQUcsTUFBTUQsYUFBYSxDQUFDQyxPQUFkLEVBQXBCO0FBQ0EsUUFBTUEsT0FBTyxDQUFDQyxHQUFSLENBQWEsMkJBQWIsQ0FBTjtBQUNBdEMsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksMEJBQVo7QUFDQW9DLEVBQUFBLE9BQU8sQ0FBQ3JELEtBQVI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIHByb2R1Y2UganNvbiBncmFwaCBkYXRhIGZyb20gZGF0YWJhc2UgcXVlcmllc1xyXG5cclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcclxuaW1wb3J0IGFzc2VydCBmcm9tICdhc3NlcnQnXHJcbmltcG9ydCB7IHByb21pc2VzIGFzIGZpbGVzeXN0ZW0sIGV4aXN0c1N5bmMsIG1rZGlyU3luYyB9IGZyb20gJ2ZzJ1xyXG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tICdAZGVwZW5kZW5jeS9lbnRpdHknXHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnQGRlcGVuZGVuY3kvZ3JhcGhUcmF2ZXJzYWwnXHJcbmltcG9ydCAqIGFzIGltcGxlbWVudGF0aW9uIGZyb20gJ0BkZXBlbmRlbmN5L2dyYXBoVHJhdmVyc2FsLWltcGxlbWVudGF0aW9uJ1xyXG5pbXBvcnQgeyBmaWxlIH0gZnJvbSAnYmFiZWwtdHlwZXMnXHJcbmNvbnN0IHV1aWR2NCA9IHJlcXVpcmUoJ3V1aWQvdjQnKVxyXG5cclxuLy8gcmVtb3ZlIGR1cGxpY2F0ZSBvYmplY3RzIGZyb20gYXJyYXkgdXNpbmcgdGhlIGlkZW50aXR5IHByb3BlcnR5IHRvIGNoZWNrIGVxdWFsaXR5XHJcbmZ1bmN0aW9uIHJlbW92ZUFycmF5RHVwbGljYXRlT2JqZWN0QnlJZGVudGl0eShhcnJheSkge1xyXG4gIGxldCB1bmlxdWUgPSBbXVxyXG4gIGFycmF5LmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICBpZiAoIXVuaXF1ZS5zb21lKGkgPT4gaS5pZGVudGl0eSA9PSBpdGVtLmlkZW50aXR5KSkgdW5pcXVlLnB1c2goaXRlbSlcclxuICB9KVxyXG4gIHJldHVybiB1bmlxdWVcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRHcmFwaERhdGFGcm9tRmlsZSh7IGFwaSAvKipzY3JpcHRNYW5hZ2VyIGFwaSovLCBzaG91bGRDbGVhckRhdGFiYXNlID0gZmFsc2UsIGdyYXBoRGF0YUZpbGVQYXRoLCB1cmwgPSB7IHByb3RvY29sOiAnYm9sdCcsIGhvc3RuYW1lOiAnbG9jYWxob3N0JywgcG9ydDogNzY4NyB9IH0gPSB7fSkge1xyXG4gIGxldCBjb25jcmV0ZURhdGFiYXNlQmVoYXZpb3IgPSBuZXcgRGF0YWJhc2UuY2xpZW50SW50ZXJmYWNlKHtcclxuICAgIGltcGxlbWVudGF0aW9uTGlzdDogeyBib2x0Q3lwaGVyTW9kZWxBZGFwdGVyOiBpbXBsZW1lbnRhdGlvbi5kYXRhYmFzZS5ib2x0Q3lwaGVyTW9kZWxBZGFwdGVyRnVuY3Rpb24oeyB1cmwgfSkgfSxcclxuICAgIGRlZmF1bHRJbXBsZW1lbnRhdGlvbjogJ2JvbHRDeXBoZXJNb2RlbEFkYXB0ZXInLFxyXG4gIH0pXHJcbiAgbGV0IGNvbmNlcmV0ZURhdGFiYXNlID0gY29uY3JldGVEYXRhYmFzZUJlaGF2aW9yW0RhdGFiYXNlLiQua2V5LmdldHRlcl0oKVxyXG5cclxuICBhc3NlcnQoZ3JhcGhEYXRhRmlsZVBhdGgsIGDigKIgZ3JhcGhEYXRhRmlsZVBhdGggbXVzdCBiZSBwYXNzZWQgdG8gc2NyaXB0IC0gJHtncmFwaERhdGFGaWxlUGF0aH1gKVxyXG4gIGNvbnN0IHRhcmdldFByb2plY3RSb290UGF0aCA9IGFwaS5wcm9qZWN0LmNvbmZpZ3VyYXRpb24uY29uZmlndXJhdGlvbi5kaXJlY3Rvcnkucm9vdFxyXG4gIGlmIChzaG91bGRDbGVhckRhdGFiYXNlKSBhd2FpdCBjbGVhckRhdGFiYXNlKHsgY29uY2VyZXRlRGF0YWJhc2UsIHVybCB9KVxyXG4gIGxldCBhYnNvbHV0ZVBhdGggPSBwYXRoLmlzQWJzb2x1dGUoZ3JhcGhEYXRhRmlsZVBhdGgpID8gZ3JhcGhEYXRhRmlsZVBhdGggOiBwYXRoLmpvaW4odGFyZ2V0UHJvamVjdFJvb3RQYXRoLCBncmFwaERhdGFGaWxlUGF0aClcclxuICBsZXQgZ3JhcGhEYXRhID0gcmVxdWlyZShhYnNvbHV0ZVBhdGgpXHJcbiAgYXNzZXJ0KEFycmF5LmlzQXJyYXkoZ3JhcGhEYXRhLm5vZGUpICYmIEFycmF5LmlzQXJyYXkoZ3JhcGhEYXRhLmVkZ2UpLCBg4oCiIFVuc3VwcG9ydGVkIGdyYXBoIGRhdGEgc3RyY3V0dXJlLSAke2dyYXBoRGF0YS5lZGdlfSAtICR7Z3JhcGhEYXRhLm5vZGV9YClcclxuICBhd2FpdCBjb25jZXJldGVEYXRhYmFzZS5sb2FkR3JhcGhEYXRhKHsgbm9kZUVudHJ5RGF0YTogZ3JhcGhEYXRhLm5vZGUsIGNvbm5lY3Rpb25FbnRyeURhdGE6IGdyYXBoRGF0YS5lZGdlIH0pXHJcbiAgY29uY2VyZXRlRGF0YWJhc2UuZHJpdmVySW5zdGFuY2UuY2xvc2UoKVxyXG59XHJcblxyXG4vLyBSZWxpZXMgb24gdGhlIGludGVyZmFjZSBmb3IgY29uY3JldGUgZGF0YWJhc2UgcGx1Z2lucyBvZiBncmFwaFRyYXZlcnNhbCBtb2R1bGUuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRBbGxHcmFwaERhdGEoe1xyXG4gIGFwaSxcclxuICB0YXJnZXRQYXRoID0gJy4vdGVzdC9hc3NldC8nLFxyXG4gIGZpbGVOYW1lID0gJ2dyYXBoRGF0YS5leHBvcnRlZC5qc29uJyxcclxuICB1cmwgPSB7IHByb3RvY29sOiAnYm9sdCcsIGhvc3RuYW1lOiAnbG9jYWxob3N0JywgcG9ydDogNzY4NyB9LFxyXG4gIGZpeEdyYXBoRGF0YSA9IHRydWUsXHJcbn0gPSB7fSkge1xyXG4gIGxldCBjb25jcmV0ZURhdGFiYXNlQmVoYXZpb3IgPSBuZXcgRGF0YWJhc2UuY2xpZW50SW50ZXJmYWNlKHtcclxuICAgIGltcGxlbWVudGF0aW9uTGlzdDogeyBib2x0Q3lwaGVyTW9kZWxBZGFwdGVyOiBpbXBsZW1lbnRhdGlvbi5kYXRhYmFzZS5ib2x0Q3lwaGVyTW9kZWxBZGFwdGVyRnVuY3Rpb24oeyB1cmwgfSkgfSxcclxuICAgIGRlZmF1bHRJbXBsZW1lbnRhdGlvbjogJ2JvbHRDeXBoZXJNb2RlbEFkYXB0ZXInLFxyXG4gIH0pXHJcbiAgbGV0IGNvbmNlcmV0ZURhdGFiYXNlID0gY29uY3JldGVEYXRhYmFzZUJlaGF2aW9yW0RhdGFiYXNlLiQua2V5LmdldHRlcl0oKVxyXG5cclxuICBjb25zdCB0YXJnZXRQcm9qZWN0Um9vdFBhdGggPSBhcGkucHJvamVjdC5jb25maWd1cmF0aW9uLmNvbmZpZ3VyYXRpb24uZGlyZWN0b3J5LnJvb3RcclxuICBjb25zdCBleHBvcnRQYXRoID0gcGF0aC5ub3JtYWxpemUocGF0aC5qb2luKHRhcmdldFByb2plY3RSb290UGF0aCwgdGFyZ2V0UGF0aCkpXHJcblxyXG4gIGxldCBncmFwaERhdGEgPSB7IG5vZGU6IGF3YWl0IGNvbmNlcmV0ZURhdGFiYXNlLmdldEFsbE5vZGUoKSwgZWRnZTogYXdhaXQgY29uY2VyZXRlRGF0YWJhc2UuZ2V0QWxsRWRnZSgpIH0gfD4gSlNPTi5zdHJpbmdpZnlcclxuXHJcbiAgaWYgKCFleGlzdHNTeW5jKGV4cG9ydFBhdGgpKSBta2RpclN5bmMoZXhwb3J0UGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSkgLy8gY3JlYXRlIGJhc2UgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcclxuICBhd2FpdCBmaWxlc3lzdGVtLndyaXRlRmlsZShwYXRoLmpvaW4oZXhwb3J0UGF0aCwgZmlsZU5hbWUpLCBncmFwaERhdGEsIHsgZW5jb2Rpbmc6ICd1dGY4JywgZmxhZzogJ3cnIC8qdHJ1Y3RhY2UgZmlsZSBpZiBleGlzdHMgYW5kIGNyZWF0ZSBhIG5ldyBvbmUqLyB9KVxyXG4gIGNvbnNvbGUubG9nKGDigKIgQ3JlYXRlZCBqc29uIGZpbGUgLSAke3BhdGguam9pbihleHBvcnRQYXRoLCBmaWxlTmFtZSl9YClcclxuXHJcbiAgaWYgKGZpeEdyYXBoRGF0YSkgYXdhaXQgZml4SlNPTkRhdGEoeyBhcGksIHRhcmdldFBhdGgsIGV4cG9ydGVkRmlsZU5hbWU6IGZpbGVOYW1lLCB0YXJnZXRGaWxlTmFtZTogZmlsZU5hbWUsIHVybCB9KSAvLyBGb3Igbm9kZXMgbGFraW5nIGtleXMsIGdlbmVyYXRlIHJhbmRvbSBrZXlzLlxyXG5cclxuICBjb25jZXJldGVEYXRhYmFzZS5kcml2ZXJJbnN0YW5jZS5jbG9zZSgpXHJcbn1cclxuXHJcbi8vIEV4cG9ydCBzdWJncmFwaHMgdGhyb3VnaCBzcGVjaWZ5aW5nIGVudHJ5cG9pbnRzIHdoaWNoIHdpbGwgcmVjdXJzaXZlbHkgdHJhdmVyc2UgdGhyb3VnaCBuZWlnaGJvcmluZyBub2RlcyBhbmQgYWRkIHRoZW0uXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRTdWJncmFwaERhdGEoe1xyXG4gIGFwaSxcclxuICBzdWJncmFwaEVudHJ5Tm9kZUtleUxpc3QgPSBbXSxcclxuICB0YXJnZXRQYXRoID0gJy4vdGVzdC9hc3NldC8nLFxyXG4gIGZpbGVOYW1lID0gJ3NwZWNpZmljLmV4cG9ydGVkLmpzb24nLFxyXG4gIHVybCA9IHsgcHJvdG9jb2w6ICdib2x0JywgaG9zdG5hbWU6ICdsb2NhbGhvc3QnLCBwb3J0OiA3Njg3IH0sXHJcbiAgZml4R3JhcGhEYXRhID0gdHJ1ZSxcclxufSA9IHt9KSB7XHJcbiAgbGV0IGNvbmNyZXRlRGF0YWJhc2VCZWhhdmlvciA9IG5ldyBEYXRhYmFzZS5jbGllbnRJbnRlcmZhY2Uoe1xyXG4gICAgaW1wbGVtZW50YXRpb25MaXN0OiB7IGJvbHRDeXBoZXJNb2RlbEFkYXB0ZXI6IGltcGxlbWVudGF0aW9uLmRhdGFiYXNlLmJvbHRDeXBoZXJNb2RlbEFkYXB0ZXJGdW5jdGlvbih7IHVybCB9KSB9LFxyXG4gICAgZGVmYXVsdEltcGxlbWVudGF0aW9uOiAnYm9sdEN5cGhlck1vZGVsQWRhcHRlcicsXHJcbiAgfSlcclxuICBsZXQgY29uY2VyZXRlRGF0YWJhc2UgPSBjb25jcmV0ZURhdGFiYXNlQmVoYXZpb3JbRGF0YWJhc2UuJC5rZXkuZ2V0dGVyXSgpXHJcblxyXG4gIGNvbnN0IHRhcmdldFByb2plY3RSb290UGF0aCA9IGFwaS5wcm9qZWN0LmNvbmZpZ3VyYXRpb24uY29uZmlndXJhdGlvbi5kaXJlY3Rvcnkucm9vdFxyXG4gIGNvbnN0IGV4cG9ydFBhdGggPSBwYXRoLm5vcm1hbGl6ZShwYXRoLmpvaW4odGFyZ2V0UHJvamVjdFJvb3RQYXRoLCB0YXJnZXRQYXRoKSlcclxuXHJcbiAgLy8gY29udmVydCBrZXkgdG8gaWRlbnRpdHkgb2Ygbm9kZVxyXG4gIGxldCBzdWJncmFwaEVudHJ5Tm9kZUlkZW50aXR5TGlzdCA9IG5ldyBTZXQoKVxyXG4gIGZvciAobGV0IGtleSBvZiBzdWJncmFwaEVudHJ5Tm9kZUtleUxpc3QpIHN1YmdyYXBoRW50cnlOb2RlSWRlbnRpdHlMaXN0LmFkZCgoYXdhaXQgY29uY2VyZXRlRGF0YWJhc2UuZ2V0Tm9kZUJ5S2V5KHsga2V5IH0pKS5pZGVudGl0eSlcclxuXHJcbiAgbGV0IGV4cG9ydE5vZGVMaXN0ID0gbmV3IFNldCgpLFxyXG4gICAgZXhwb3J0RWRnZUxpc3QgPSBuZXcgU2V0KClcclxuXHJcbiAgLy8gZ2V0IHRoZSBjb25uZWN0aW9ucyBiZXR3ZWVuIHRoZSBub2Rlc1xyXG4gIGxldCBoYXNoVHJhdmVyc2VkTm9kZSA9IG5ldyBTZXQoKVxyXG4gIGFzeW5jIGZ1bmN0aW9uIGFkZFJlbGF0ZWROb2RlKG5vZGVBcnJheSkge1xyXG4gICAgZm9yIChsZXQgaWRlbnRpdHkgb2Ygbm9kZUFycmF5KSB7XHJcbiAgICAgIGlmICghaGFzaFRyYXZlcnNlZE5vZGUuaGFzKGlkZW50aXR5KSkge1xyXG4gICAgICAgIGhhc2hUcmF2ZXJzZWROb2RlLmFkZChpZGVudGl0eSlcclxuXHJcbiAgICAgICAgbGV0IGNvbm5lY3Rpb25BcnJheSA9IGF3YWl0IGNvbmNlcmV0ZURhdGFiYXNlLmdldE5vZGVDb25uZWN0aW9uKHsgbm9kZUlEOiBpZGVudGl0eSB9KVxyXG4gICAgICAgIGV4cG9ydEVkZ2VMaXN0ID0gbmV3IFNldChbLi4uZXhwb3J0RWRnZUxpc3QsIC4uLmNvbm5lY3Rpb25BcnJheS5tYXAocmVzdWx0ID0+IHJlc3VsdC5jb25uZWN0aW9uLmlkZW50aXR5KSAvKiogZ2V0IHRoZSBjb25uZWN0aW9ucyBvbmx5IHdpdGhvdXQgdGhlIGRlc3RpbmF0aW9uIGFuZCBzb3VyY2Ugbm9kZXMgKi9dKVxyXG5cclxuICAgICAgICBsZXQgbmV4dE5vZGVBcnJheSA9IG5ldyBTZXQoXHJcbiAgICAgICAgICBbLi4uY29ubmVjdGlvbkFycmF5Lm1hcChyZXN1bHQgPT4gcmVzdWx0LmRlc3RpbmF0aW9uLmlkZW50aXR5KSwgLi4uY29ubmVjdGlvbkFycmF5Lm1hcChyZXN1bHQgPT4gcmVzdWx0LnNvdXJjZS5pZGVudGl0eSldLmZpbHRlcihpZGVudGl0eSA9PiAhbm9kZUFycmF5LmhhcyhpZGVudGl0eSkpLFxyXG4gICAgICAgIClcclxuXHJcbiAgICAgICAgYXdhaXQgYWRkUmVsYXRlZE5vZGUobmV4dE5vZGVBcnJheSlcclxuICAgICAgfVxyXG4gICAgICBleHBvcnROb2RlTGlzdC5hZGQoaWRlbnRpdHkpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhd2FpdCBhZGRSZWxhdGVkTm9kZShzdWJncmFwaEVudHJ5Tm9kZUlkZW50aXR5TGlzdClcclxuXHJcbiAgbGV0IGV4cG9ydE5vZGUgPSAoYXdhaXQgY29uY2VyZXRlRGF0YWJhc2UuZ2V0QWxsTm9kZSgpKS5maWx0ZXIobm9kZSA9PiBleHBvcnROb2RlTGlzdC5oYXMobm9kZS5pZGVudGl0eSkpLFxyXG4gICAgZXhwb3J0RWRnZSA9IChhd2FpdCBjb25jZXJldGVEYXRhYmFzZS5nZXRBbGxFZGdlKCkpLmZpbHRlcihlZGdlID0+IGV4cG9ydEVkZ2VMaXN0LmhhcyhlZGdlLmlkZW50aXR5KSlcclxuXHJcbiAgbGV0IGdyYXBoRGF0YSA9IHsgbm9kZTogZXhwb3J0Tm9kZSwgZWRnZTogZXhwb3J0RWRnZSB9IHw+IEpTT04uc3RyaW5naWZ5XHJcbiAgYXdhaXQgZmlsZXN5c3RlbS53cml0ZUZpbGUocGF0aC5qb2luKGV4cG9ydFBhdGgsIGZpbGVOYW1lKSwgZ3JhcGhEYXRhLCB7IGVuY29kaW5nOiAndXRmOCcsIGZsYWc6ICd3JyAvKnRydWN0YWNlIGZpbGUgaWYgZXhpc3RzIGFuZCBjcmVhdGUgYSBuZXcgb25lKi8gfSlcclxuICBjb25zb2xlLmxvZyhg4oCiIENyZWF0ZWQganNvbiBmaWxlIC0gJHtwYXRoLmpvaW4oZXhwb3J0UGF0aCwgZmlsZU5hbWUpfWApXHJcblxyXG4gIGlmIChmaXhHcmFwaERhdGEpIGF3YWl0IGZpeEpTT05EYXRhKHsgYXBpLCB0YXJnZXRQYXRoLCBleHBvcnRlZEZpbGVOYW1lOiBmaWxlTmFtZSwgdGFyZ2V0RmlsZU5hbWU6IGZpbGVOYW1lLCB1cmwgfSkgLy8gRm9yIG5vZGVzIGxha2luZyBrZXlzLCBnZW5lcmF0ZSByYW5kb20ga2V5cy5cclxuICBjb25jZXJldGVEYXRhYmFzZS5kcml2ZXJJbnN0YW5jZS5jbG9zZSgpXHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRTcGVjaWZpY0dyYXBoRGF0YSh7IGFwaSwgdGFyZ2V0UGF0aCA9ICcuL3Rlc3QvYXNzZXQvJywgZmlsZU5hbWUgPSAnc3BlY2lmaWMuZXhwb3J0ZWQuanNvbicsIHVybCA9IHsgcHJvdG9jb2w6ICdib2x0JywgaG9zdG5hbWU6ICdsb2NhbGhvc3QnLCBwb3J0OiA3Njg3IH0gfSA9IHt9KSB7XHJcbiAgbGV0IGNvbmNyZXRlRGF0YWJhc2VCZWhhdmlvciA9IG5ldyBEYXRhYmFzZS5jbGllbnRJbnRlcmZhY2Uoe1xyXG4gICAgaW1wbGVtZW50YXRpb25MaXN0OiB7IGJvbHRDeXBoZXJNb2RlbEFkYXB0ZXI6IGltcGxlbWVudGF0aW9uLmRhdGFiYXNlLmJvbHRDeXBoZXJNb2RlbEFkYXB0ZXJGdW5jdGlvbih7IHVybCB9KSB9LFxyXG4gICAgZGVmYXVsdEltcGxlbWVudGF0aW9uOiAnYm9sdEN5cGhlck1vZGVsQWRhcHRlcicsXHJcbiAgfSlcclxuICBsZXQgY29uY2VyZXRlRGF0YWJhc2UgPSBjb25jcmV0ZURhdGFiYXNlQmVoYXZpb3JbRGF0YWJhc2UuJC5rZXkuZ2V0dGVyXSgpXHJcblxyXG4gIGNvbnN0IHRhcmdldFByb2plY3RSb290UGF0aCA9IGFwaS5wcm9qZWN0LmNvbmZpZ3VyYXRpb24uY29uZmlndXJhdGlvbi5kaXJlY3Rvcnkucm9vdFxyXG4gIGNvbnN0IGV4cG9ydFBhdGggPSBwYXRoLm5vcm1hbGl6ZShwYXRoLmpvaW4odGFyZ2V0UHJvamVjdFJvb3RQYXRoLCB0YXJnZXRQYXRoKSlcclxuXHJcbiAgLy8gcHJvdmlkZSBsaXN0IG9mIG5vZGUga2V5cyB0byBleHBvcnQgKG5vZGVzIHdpbGwgYmUgZXhwb3J0ZWQgd2l0aCB0aGVpciBjb25uZWN0aW9ucyByZWxhdGVkIHRvIHRoZSBzcGVjaWZpYyBub2RlcyBvbmx5KVxyXG4gIGxldCBub2RlS2V5QXJyYXkgPSBbXHJcbiAgICAvLyBsaXN0IG9mIG5vZGUga2V5cyB0byBleHBvcnQuXHJcbiAgXVxyXG4gIGxldCBub2RlQXJyYXkgPSBbXSxcclxuICAgIGVkZ2VBcnJheSA9IFtdXHJcblxyXG4gIC8vIGdldCBub2Rlc1xyXG4gIGZvciAobGV0IGtleSBvZiBub2RlS2V5QXJyYXkpIG5vZGVBcnJheS5wdXNoKGF3YWl0IGNvbmNlcmV0ZURhdGFiYXNlLmdldE5vZGVCeUtleSh7IGtleSB9KSlcclxuXHJcbiAgLy8gZ2V0IHRoZSBjb25uZWN0aW9ucyBiZXR3ZWVuIHRoZSBub2Rlc1xyXG4gIGZvciAobGV0IG5vZGUgb2Ygbm9kZUFycmF5KSB7XHJcbiAgICBsZXQgcXVlcnlSZXN1bHRBcnJheSA9IGF3YWl0IGNvbmNlcmV0ZURhdGFiYXNlLmdldE5vZGVDb25uZWN0aW9uKHsgbm9kZUlEOiBub2RlLmlkZW50aXR5IH0pXHJcbiAgICBxdWVyeVJlc3VsdEFycmF5ID0gcXVlcnlSZXN1bHRBcnJheS5tYXAocmVzdWx0ID0+IHJlc3VsdC5jb25uZWN0aW9uKSAvLyBnZXQgdGhlIGNvbm5lY3Rpb25zIG9ubHkgd2l0aG91dCB0aGUgZGVzdGluYXRpb24gYW5kIHNvdXJjZSBub2Rlc1xyXG4gICAgZWRnZUFycmF5ID0gWy4uLmVkZ2VBcnJheSwgLi4ucXVlcnlSZXN1bHRBcnJheV1cclxuICB9XHJcblxyXG4gIC8vIGZpbHRlciBlZGdlcyBvZiB0aGUgc3BlY2lmaWMgbm9kZXMgb25seVxyXG4gIGVkZ2VBcnJheSA9IGVkZ2VBcnJheS5maWx0ZXIoZWRnZSA9PiBub2RlQXJyYXkuc29tZShub2RlID0+IG5vZGUuaWRlbnRpdHkgPT0gZWRnZS5zdGFydCkgJiYgbm9kZUFycmF5LnNvbWUobm9kZSA9PiBub2RlLmlkZW50aXR5ID09IGVkZ2UuZW5kKSlcclxuICAvLyBmaWx0ZXIgZHVwbGljYXRlc1xyXG4gIGVkZ2VBcnJheSA9IHJlbW92ZUFycmF5RHVwbGljYXRlT2JqZWN0QnlJZGVudGl0eShlZGdlQXJyYXkpXHJcblxyXG4gIGxldCBncmFwaERhdGEgPSB7IG5vZGU6IG5vZGVBcnJheSwgZWRnZTogZWRnZUFycmF5IH0gfD4gSlNPTi5zdHJpbmdpZnlcclxuICBhd2FpdCBmaWxlc3lzdGVtLndyaXRlRmlsZShwYXRoLmpvaW4oZXhwb3J0UGF0aCwgZmlsZU5hbWUpLCBncmFwaERhdGEsIHsgZW5jb2Rpbmc6ICd1dGY4JywgZmxhZzogJ3cnIC8qdHJ1Y3RhY2UgZmlsZSBpZiBleGlzdHMgYW5kIGNyZWF0ZSBhIG5ldyBvbmUqLyB9KVxyXG4gIGNvbnNvbGUubG9nKGDigKIgQ3JlYXRlZCBqc29uIGZpbGUgLSAke3BhdGguam9pbihleHBvcnRQYXRoLCBmaWxlTmFtZSl9YClcclxuICBjb25jZXJldGVEYXRhYmFzZS5kcml2ZXJJbnN0YW5jZS5jbG9zZSgpXHJcbn1cclxuXHJcbi8qKiBUaGlzIGZ1bmN0aW9uIHJld3JpdGVzIHRoZSBqc29uIGZpbGUgLSBhbnkgbW9kaWZpY2F0aW9ucyBzaG91bGQgYmUgYWRkZWQgaW4gdGhlIGZ1bmN0aW9uLlxyXG4gKiBgeWFybiBydW4gc2NyaXB0TWFuYWdlciBzaG91bGRDb21waWxlU2NyaXB0PXRydWUgZ3JhcGhEYXRhYmFzZS9leHBvcnRHcmFwaERhdGEgXCIuZml4SlNPTkRhdGEoeyB9KVwiYFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpeEpTT05EYXRhKHsgYXBpLCB0YXJnZXRQYXRoID0gJy4vcmVzb3VyY2UvJywgZXhwb3J0ZWRGaWxlTmFtZSA9ICdmaXhlZC5leHBvcnRlZC5qc29uJywgdGFyZ2V0RmlsZU5hbWUgPSAndGFza1NlcXVlbmNlLmdyYXBoRGF0YS5qc29uJyB9ID0ge30pIHtcclxuICBjb25zdCB0YXJnZXRQcm9qZWN0Um9vdFBhdGggPSBhcGkucHJvamVjdC5jb25maWd1cmF0aW9uLmNvbmZpZ3VyYXRpb24uZGlyZWN0b3J5LnJvb3RcclxuICBsZXQgZ3JhcGhEYXRhID0gcmVxdWlyZShwYXRoLmpvaW4odGFyZ2V0UHJvamVjdFJvb3RQYXRoLCB0YXJnZXRQYXRoLCB0YXJnZXRGaWxlTmFtZSkpXHJcblxyXG4gIC8vIG1vZGlmeSBkYXRhXHJcbiAgZ3JhcGhEYXRhLm5vZGUgPSBncmFwaERhdGEubm9kZS5tYXAoaXRlbSA9PiB7XHJcbiAgICAvLyBhZGQga2V5IHRvIG5vZGVzIHdpdGhvdXQga2V5XHJcbiAgICBpZiAoIWl0ZW0ucHJvcGVydGllcy5rZXkpIHtcclxuICAgICAgY29uc29sZS5sb2coYOKAoiBGaXhpbmcgbm9kZSB3aXRob3V0IGtleSAtIGAgKyBKU09OLnN0cmluZ2lmeShpdGVtKSlcclxuICAgICAgaXRlbS5wcm9wZXJ0aWVzLmtleSA9IHV1aWR2NCgpXHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbVxyXG4gIH0pXHJcbiAgZ3JhcGhEYXRhLmVkZ2UgPSBncmFwaERhdGEuZWRnZS5tYXAoaXRlbSA9PiB7XHJcbiAgICAvLyBhZGQga2V5IHRvIGNvbm5lY3Rpb25zIHdpdGhvdXQga2V5XHJcbiAgICBpZiAoIWl0ZW0ucHJvcGVydGllcy5rZXkpIHtcclxuICAgICAgY29uc29sZS5sb2coYOKAoiBGaXhpbmcgZWRnZSB3aXRob3V0IGtleSAtIGAgKyBKU09OLnN0cmluZ2lmeShpdGVtKSlcclxuICAgICAgaXRlbS5wcm9wZXJ0aWVzLmtleSA9IHV1aWR2NCgpXHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbVxyXG4gIH0pXHJcblxyXG4gIGNvbnN0IGV4cG9ydFBhdGggPSBwYXRoLm5vcm1hbGl6ZShwYXRoLmpvaW4odGFyZ2V0UHJvamVjdFJvb3RQYXRoLCB0YXJnZXRQYXRoLCBleHBvcnRlZEZpbGVOYW1lKSlcclxuICBhd2FpdCBmaWxlc3lzdGVtLndyaXRlRmlsZShleHBvcnRQYXRoLCBncmFwaERhdGEgfD4gSlNPTi5zdHJpbmdpZnksIHsgZW5jb2Rpbmc6ICd1dGY4JywgZmxhZzogJ3cnIC8qdHJ1Y3RhY2UgZmlsZSBpZiBleGlzdHMgYW5kIGNyZWF0ZSBhIG5ldyBvbmUqLyB9KVxyXG4gIGNvbnNvbGUubG9nKGDigKIgQ3JlYXRlZCBqc29uIGZpbGUgLSAke2V4cG9ydFBhdGh9YClcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFyRGF0YWJhc2UoeyBjb25jZXJldGVEYXRhYmFzZSwgdXJsID0geyBwcm90b2NvbDogJ2JvbHQnLCBob3N0bmFtZTogJ2xvY2FsaG9zdCcsIHBvcnQ6IDc2ODcgfSB9KSB7XHJcbiAgaWYgKCFjb25jZXJldGVEYXRhYmFzZSkge1xyXG4gICAgbGV0IGNvbmNyZXRlRGF0YWJhc2VCZWhhdmlvciA9IG5ldyBEYXRhYmFzZS5jbGllbnRJbnRlcmZhY2Uoe1xyXG4gICAgICBpbXBsZW1lbnRhdGlvbkxpc3Q6IHsgYm9sdEN5cGhlck1vZGVsQWRhcHRlcjogaW1wbGVtZW50YXRpb24uZGF0YWJhc2UuYm9sdEN5cGhlck1vZGVsQWRhcHRlckZ1bmN0aW9uKHsgdXJsIH0pIH0sXHJcbiAgICAgIGRlZmF1bHRJbXBsZW1lbnRhdGlvbjogJ2JvbHRDeXBoZXJNb2RlbEFkYXB0ZXInLFxyXG4gICAgfSlcclxuICAgIGNvbmNlcmV0ZURhdGFiYXNlID0gY29uY3JldGVEYXRhYmFzZUJlaGF2aW9yW0RhdGFiYXNlLiQua2V5LmdldHRlcl0oKVxyXG4gIH1cclxuXHJcbiAgLy8gRGVsZXRlIGFsbCBub2RlcyBpbiB0aGUgaW4tbWVtb3J5IGRhdGFiYXNlXHJcbiAgY29uc3QgZ3JhcGhEQkRyaXZlciA9IGNvbmNlcmV0ZURhdGFiYXNlLmRyaXZlckluc3RhbmNlXHJcbiAgbGV0IHNlc3Npb24gPSBhd2FpdCBncmFwaERCRHJpdmVyLnNlc3Npb24oKVxyXG4gIGF3YWl0IHNlc3Npb24ucnVuKGBtYXRjaCAobikgZGV0YWNoIGRlbGV0ZSBuYClcclxuICBjb25zb2xlLmxvZygn4oCiIERhdGFiYXNlIGRhdGEgY2xlYXJlZC4nKVxyXG4gIHNlc3Npb24uY2xvc2UoKVxyXG59XHJcbiJdfQ==