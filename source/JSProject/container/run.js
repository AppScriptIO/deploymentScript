"use strict";var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.dockerCli = dockerCli;exports.dockerComposeCli = dockerComposeCli;var _child_process = require("child_process");
var _os = _interopRequireDefault(require("os"));
var _path = _interopRequireDefault(require("path"));
var _fs = _interopRequireDefault(require("fs"));



var jsYaml = _interopRequireWildcard(require("js-yaml"));
var _mkdirp = _interopRequireDefault(require("mkdirp"));

const developmentCodeFolder = _path.default.join(_os.default.homedir(), 'code'),
yarnLinkFolrder = _path.default.join(_os.default.homedir(), '.config');


const dockerDeploymentImage = 'myuserindocker/deployment-environment:latest' || 'node:current';

async function dockerCli({ api, scriptCommand = '/bin/bash' } = {}) {
  const applicationPath = _path.default.join(api.project.configuration.rootPath, 'entrypoint/cli'),
  rootPath = api.project.configuration.rootPath,
  containerProjectPath = rootPath;

  let executableCommand = [
  'docker',
  `run`,




  '--init',
  '--sig-proxy',
  `--interactive --tty`,
  `--rm`,
  `--workdir ${containerProjectPath}`,

  `--volume ${rootPath}:${containerProjectPath}`,

  `--volume ${developmentCodeFolder}:${developmentCodeFolder}`,
  `--volume ${yarnLinkFolrder}:${yarnLinkFolrder}`,
  `--volume /var/run/docker.sock:/var/run/docker.sock`,



  `--user ${_os.default.userInfo().uid}:${_os.default.userInfo().gid}`,
  `--volume /etc/passwd:/etc/passwd:ro`,
  `--volume /etc/group:/etc/group:ro`,
  `--volume /etc/shadow:/etc/shadow:ro`,


  `--network=${'external'}`,
  `--network-alias ${'application'}`,



  `-p 443:443 -p 8080:8080 -p 8081:8081 -p 8082:8082 -p 8083:8083 -p 8084:8084 -p 8085:8085`,
  `-p 9229:9229`,
  `-p 9090:9090 -p 9901:9901 -p 9902:9902`,




  `${dockerDeploymentImage}`,
  scriptCommand];


  console.log('container command' + ': \n', scriptCommand);
  console.log(`• docker command: "${executableCommand.join(' ')}"`);

  let option = {
    cwd: rootPath,
    detached: false,
    shell: true,
    stdio: [0, 1, 2],

    env: Object.assign({}, process.env, {}) };



  const [command, ...commandArgument] = executableCommand;
  (0, _child_process.spawnSync)(command, commandArgument, option);
}



async function dockerComposeCli({ api, scriptCommand = '/bin/bash' } = {}) {
  const targetProjectConf = api.project.configuration.configuration,
  rootPath = api.project.configuration.rootPath,
  targetTemporaryFolder = _path.default.join(rootPath, 'temporary'),
  containerProjectPath = rootPath;

  await (0, _mkdirp.default)(targetTemporaryFolder);

  let option = {
    cwd: rootPath,
    detached: false,
    shell: true,
    stdio: [0, 1, 2],

    env: Object.assign({}, process.env, {}) };




  let portList = [
  ...targetProjectConf.apiGateway.service.map(item => item.port).filter(item => item),

  ...[

  9229,

  9090,
  9901,
  9902]];


  let serviceConfig = {
    version: '3.7',

    networks: {
      internal: {
        driver: 'bridge' } },



    services: {
      application: {
        image: dockerDeploymentImage,



        ports: portList.map(port => {
          return {
            target: port,
            published: port };


        }),

        networks: {
          internal: {
            aliases: ['application'] } },



        volumes: [
        `${rootPath}:${containerProjectPath}`,

        `${developmentCodeFolder}:${developmentCodeFolder}`,
        `${yarnLinkFolrder}:${yarnLinkFolrder}`,
        `/var/run/docker.sock:/var/run/docker.sock`,


        `/etc/passwd:/etc/passwd:ro`,
        `/etc/group:/etc/group:ro`,
        `/etc/shadow:/etc/shadow:ro`],


        user: `${_os.default.userInfo().uid}:${_os.default.userInfo().gid}`,
        working_dir: rootPath,


        command: scriptCommand,






        tty: true,
        stdin_open: true },


      memgraph: {
        image: 'memgraph:latest',


        ports: [
        {
          target: 7687 }],




        networks: {
          internal: {
            aliases: ['memgraph'] } } } } };







  let yamlFile = _path.default.join(targetTemporaryFolder, 'dockerCompose.yaml');
  _fs.default.writeFileSync(yamlFile, jsYaml.dump(serviceConfig, { lineWidth: Infinity, noCompatMode: true }));

  let dockerComposeCommand = `docker-compose --file ${yamlFile} --project-name webappProject --log-level INFO`;

  {


    let executableCommand = [
    [
    dockerComposeCommand,
    'down --volumes'].
    join(' ')];

    const [command, ...commandArgument] = executableCommand;
    (0, _child_process.spawnSync)(command, commandArgument, option);
  }

  let executableCommand = [
  [
  dockerComposeCommand,







  `up --no-build --force-recreate --abort-on-container-exit --always-recreate-deps`].
  join(' ')];


  console.log('container command' + ': \n', scriptCommand);
  console.log(`• docker command: "${executableCommand.join(' ')}"`);
  const [command, ...commandArgument] = executableCommand;
  (0, _child_process.spawnSync)(command, commandArgument, option);



  process.on('SIGINT', (code, signal) => {
    console.log(`[Process ${process.pid}]: signal ${signal}, code ${code};`);

    let executableCommand = [
    [
    dockerComposeCommand,
    'down'].

    join(' ')];

    const [command, ...commandArgument] = executableCommand;
    (0, _child_process.spawnSync)(command, commandArgument, option);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NvdXJjZS9KU1Byb2plY3QvY29udGFpbmVyL3J1bi5qcyJdLCJuYW1lcyI6WyJkZXZlbG9wbWVudENvZGVGb2xkZXIiLCJwYXRoIiwiam9pbiIsIm9wZXJhdGluZ1N5c3RlbSIsImhvbWVkaXIiLCJ5YXJuTGlua0ZvbHJkZXIiLCJkb2NrZXJEZXBsb3ltZW50SW1hZ2UiLCJkb2NrZXJDbGkiLCJhcGkiLCJzY3JpcHRDb21tYW5kIiwiYXBwbGljYXRpb25QYXRoIiwicHJvamVjdCIsImNvbmZpZ3VyYXRpb24iLCJyb290UGF0aCIsImNvbnRhaW5lclByb2plY3RQYXRoIiwiZXhlY3V0YWJsZUNvbW1hbmQiLCJ1c2VySW5mbyIsInVpZCIsImdpZCIsImNvbnNvbGUiLCJsb2ciLCJvcHRpb24iLCJjd2QiLCJkZXRhY2hlZCIsInNoZWxsIiwic3RkaW8iLCJlbnYiLCJPYmplY3QiLCJhc3NpZ24iLCJwcm9jZXNzIiwiY29tbWFuZCIsImNvbW1hbmRBcmd1bWVudCIsImRvY2tlckNvbXBvc2VDbGkiLCJ0YXJnZXRQcm9qZWN0Q29uZiIsInRhcmdldFRlbXBvcmFyeUZvbGRlciIsInBvcnRMaXN0IiwiYXBpR2F0ZXdheSIsInNlcnZpY2UiLCJtYXAiLCJpdGVtIiwicG9ydCIsImZpbHRlciIsInNlcnZpY2VDb25maWciLCJ2ZXJzaW9uIiwibmV0d29ya3MiLCJpbnRlcm5hbCIsImRyaXZlciIsInNlcnZpY2VzIiwiYXBwbGljYXRpb24iLCJpbWFnZSIsInBvcnRzIiwidGFyZ2V0IiwicHVibGlzaGVkIiwiYWxpYXNlcyIsInZvbHVtZXMiLCJ1c2VyIiwid29ya2luZ19kaXIiLCJ0dHkiLCJzdGRpbl9vcGVuIiwibWVtZ3JhcGgiLCJ5YW1sRmlsZSIsImZpbGVzeXN0ZW0iLCJ3cml0ZUZpbGVTeW5jIiwianNZYW1sIiwiZHVtcCIsImxpbmVXaWR0aCIsIkluZmluaXR5Iiwibm9Db21wYXRNb2RlIiwiZG9ja2VyQ29tcG9zZUNvbW1hbmQiLCJv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QURGO0FBRUUsVUFGRjs7QUFJRWxFLElBQUFBLElBSkYsQ0FJTyxHQUpQLENBRHNCLENBQXhCOztBQU9BLFVBQU0sQ0FBQzRCLE9BQUQsRUFBVSxHQUFHQyxlQUFiLElBQWdDaEIsaUJBQXRDO0FBQ0Esa0NBQVVlLE9BQVYsRUFBbUJDLGVBQW5CLEVBQW9DVixNQUFwQztBQUNELEdBWkQ7QUFhRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWNTeW5jLCBzcGF3biwgc3Bhd25TeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2VzcydcbmltcG9ydCBvcGVyYXRpbmdTeXN0ZW0gZnJvbSAnb3MnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IGZpbGVzeXN0ZW0gZnJvbSAnZnMnXG5pbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCdcbmltcG9ydCByZXNvbHZlIGZyb20gJ3Jlc29sdmUnIC8vIHVzZSAncmVzb2x2ZScgbW9kdWxlIHRvIGFsbG93IHBhc3NpbmcgJ3ByZXNlcnZlIHN5bWxpbmtzJyBvcHRpb24gdGhhdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHJlcXVpcmUucmVzb2x2ZSBtb2R1bGUuXG5pbXBvcnQgKiBhcyBkb2NrZXJvZGUgZnJvbSAnZG9ja2Vyb2RlJ1xuaW1wb3J0ICogYXMganNZYW1sIGZyb20gJ2pzLXlhbWwnXG5pbXBvcnQgY3JlYXRlRGlyZWN0b3J5UmVjdXJzaXZlIGZyb20gJ21rZGlycCdcbi8vIHdoaWxlIGRldmVsb3BpbmcsIGFsbG93IGRlcGVuZGVuY3kgc3ltbGlua3MgdG8gd29yayBpbiBjb250YWluZXJzLlxuY29uc3QgZGV2ZWxvcG1lbnRDb2RlRm9sZGVyID0gcGF0aC5qb2luKG9wZXJhdGluZ1N5c3RlbS5ob21lZGlyKCksICdjb2RlJyksXG4gIHlhcm5MaW5rRm9scmRlciA9IHBhdGguam9pbihvcGVyYXRpbmdTeXN0ZW0uaG9tZWRpcigpLCAnLmNvbmZpZycpXG5cbi8vIHRoZSBpbWFnZSB1c2VkIGZvciBkZXZlbG9wbWVudCwgYnVpbGRpbmcgb2YgcHJvamVjdHMsIGFuZCBwcm9kdWN0aW9uIGRlcGxveW1lbnQsIHdoaWNoIGNvbnRhaW5zIGVzc2VudGlhbCB0b29scyBhbmQgYmluYXJpZXMgKGUuZy4gcnN5bmMpXG5jb25zdCBkb2NrZXJEZXBsb3ltZW50SW1hZ2UgPSAnbXl1c2VyaW5kb2NrZXIvZGVwbG95bWVudC1lbnZpcm9ubWVudDpsYXRlc3QnIHx8ICdub2RlOmN1cnJlbnQnIC8vIG5vZGVqcyAxMiB0byBzdXBwb3J0IG5vZGVnaXQgdmVyc2lvbiB0aGF0IHdvcmtzIHdpdGggRGViaWFuIDEwXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkb2NrZXJDbGkoeyBhcGkgLyogc3VwcGxpZWQgYnkgc2NyaXB0TWFuYWdlciAqLywgc2NyaXB0Q29tbWFuZCA9ICcvYmluL2Jhc2gnIH0gPSB7fSkge1xuICBjb25zdCBhcHBsaWNhdGlvblBhdGggPSBwYXRoLmpvaW4oYXBpLnByb2plY3QuY29uZmlndXJhdGlvbi5yb290UGF0aCwgJ2VudHJ5cG9pbnQvY2xpJyksXG4gICAgcm9vdFBhdGggPSBhcGkucHJvamVjdC5jb25maWd1cmF0aW9uLnJvb3RQYXRoLFxuICAgIGNvbnRhaW5lclByb2plY3RQYXRoID0gcm9vdFBhdGhcblxuICBsZXQgZXhlY3V0YWJsZUNvbW1hbmQgPSBbXG4gICAgJ2RvY2tlcicsXG4gICAgYHJ1bmAsXG5cbiAgICAvLyBgLS1uYW1lICR7J3Byb2plY3QnfWAsXG5cbiAgICAvLyAtLWV4cGVyaW1lbnRhbC1tb2R1bGVzIC0taW5wdXQtdHlwZT1jb21tb25qXG4gICAgJy0taW5pdCcsIC8vIEZpeGVzIHNpZ25hbCBoYW5kbGVycyAmIHJlYXBpbmcgKHByb2Nlc3Mgb2YgZWxpbWluYXRpbmcgem9tYmllIHByb2Nlc3NlcykuICBodHRwczovL2dpdGh1Yi5jb20va3JhbGxpbi90aW5pIGh0dHBzOi8vZ2l0aHViLmNvbS9kb2NrZXIvY2xpL3B1bGwvMTg0MVxuICAgICctLXNpZy1wcm94eScsIC8vIHBhc3Mgc2lnbmFsc1xuICAgIGAtLWludGVyYWN0aXZlIC0tdHR5YCwgLy8gYWxsb2NhdGUgYSB0ZXJtaW5hbCAtIHRoaXMgYWxsb3dzIGZvciBpbnRlcmFjdGluZyB3aXRoIHRoZSBjb250YWluZXIgcHJvY2Vzcy4gdHR5ID0gVW5peC9MaW51eCB0ZXJtaW5hbCBhY2Nlc3MgaGFuZGxpbmcgdXNpbmcgbW9kZW0gYmFzZWQgY29ubmVjdGlvbiAoYWxsb3dzIGlucHV0IGZyb20gdGVybWluYWwpLCBpdGVyYWN0aXZlID0gYWNjZXB0cyBpbnB1dCBmcm9tIGhvc3QuXG4gICAgYC0tcm1gLCAvLyBhdXRvbWF0aWNhbGx5IHJlbW92ZSBhZnRlciBjb250YWluZXIgZXhpc3RzLlxuICAgIGAtLXdvcmtkaXIgJHtjb250YWluZXJQcm9qZWN0UGF0aH1gLFxuXG4gICAgYC0tdm9sdW1lICR7cm9vdFBhdGh9OiR7Y29udGFpbmVyUHJvamVjdFBhdGh9YCxcbiAgICAvLyBsb2NhbCBkZXZlbG9wbWVudCByZWxhdGVkIHBhdGhzXG4gICAgYC0tdm9sdW1lICR7ZGV2ZWxvcG1lbnRDb2RlRm9sZGVyfToke2RldmVsb3BtZW50Q29kZUZvbGRlcn1gLFxuICAgIGAtLXZvbHVtZSAke3lhcm5MaW5rRm9scmRlcn06JHt5YXJuTGlua0ZvbHJkZXJ9YCxcbiAgICBgLS12b2x1bWUgL3Zhci9ydW4vZG9ja2VyLnNvY2s6L3Zhci9ydW4vZG9ja2VyLnNvY2tgLFxuICAgIC8vIGAtLXZvbHVtZSAke29wZXJhdGluZ1N5c3RlbS5ob21lZGlyKCl9Ly5zc2g6L3Byb2plY3QvLnNzaGAsXG5cbiAgICAvLyBhbGxvdyBmb3IgdXNpbmcgbG9jYWwgdXNlciBuYW1lIChvZiBob3N0IG1hY2hpbmUpIHRvIHdyaXRlIGZpbGVzIGFuZCBwZXJtaXNzaW9ucyB0aHJvdWdoIHRoZSBkb2NrZXIgY29udGFpbmVyLiBodHRwczovL21lZGl1bS5jb20vZmF1bi9zZXQtY3VycmVudC1ob3N0LXVzZXItZm9yLWRvY2tlci1jb250YWluZXItNGU1MjFjZWY5ZmZjXG4gICAgYC0tdXNlciAke29wZXJhdGluZ1N5c3RlbS51c2VySW5mbygpLnVpZH06JHtvcGVyYXRpbmdTeXN0ZW0udXNlckluZm8oKS5naWR9YCwgLy8gdWlkOmdpZFxuICAgIGAtLXZvbHVtZSAvZXRjL3Bhc3N3ZDovZXRjL3Bhc3N3ZDpyb2AsXG4gICAgYC0tdm9sdW1lIC9ldGMvZ3JvdXA6L2V0Yy9ncm91cDpyb2AsXG4gICAgYC0tdm9sdW1lIC9ldGMvc2hhZG93Oi9ldGMvc2hhZG93OnJvYCxcblxuICAgIC8vIGNvbnRhaW5lciBuYW1lIGlzIHJlZ2lzdGVyZWQgYnkgRG9ja2VyIGF1dG9tYXRpY2FsbHkgZm9yIG5vbiBkZWZhdWx0IG5ldHdvcmtzIGFzIGhvc3RuYW1lcyBpbiBvdGhlciBjb250YWluZXJzIChkZWZhdWx0IGJyaWRnZSBuZXR3b3JrIHdpbGwgbm90IHVzZSBob3N0bmFtZSBETlMpLCBhbGxvd2luZyBhY2Nlc3MgdG8gdGhlIG1lbWdyYXBoIGNvbnRhaW5lciB0aHJvdWdoIGl0J3MgbmFtZS4gKGRlZmF1bHQgbmV0d29yayBkb2Vzbid0IHN1cHBvcnQgYWxpYXNlcylcbiAgICBgLS1uZXR3b3JrPSR7J2V4dGVybmFsJ31gLFxuICAgIGAtLW5ldHdvcmstYWxpYXMgJHsnYXBwbGljYXRpb24nfWAsIC8vIG1ha2UgY29udGFpbmVyIGRpc2NvdmVyYWJsZSBieSBhbm90aGVyIGhvc3RuYW1lIGluIGFkZGl0aW9uIHRvIHRoZSBjb250YWluZXIgbmFtZSBmb3Igc3BlY2lmaWMgbmV0d29yay5cbiAgICAvLyBgLS1hZGQtaG9zdCBtZW1ncmFwaDoxNzIuMTcuMC4zYCxcblxuICAgIC8vIGAtUGAsIC8vIFB1Ymxpc2ggYWxsIGV4cG9zZWQgcG9ydHMgdG8gdGhlIGhvc3QgaW50ZXJmYWNlc1xuICAgIGAtcCA0NDM6NDQzIC1wIDgwODA6ODA4MCAtcCA4MDgxOjgwODEgLXAgODA4Mjo4MDgyIC1wIDgwODM6ODA4MyAtcCA4MDg0OjgwODQgLXAgODA4NTo4MDg1YCwgLy9zZXJ2aWNlcyBwb3J0c1xuICAgIGAtcCA5MjI5OjkyMjlgLCAvLyBOb2RlanMncyByZW1vdGUgZGVidWdnZXJcbiAgICBgLXAgOTA5MDo5MDkwIC1wIDk5MDE6OTkwMSAtcCA5OTAyOjk5MDJgLCAvLyBCcm93c2Vyc3luYyBsaXZlcmVsb2FkXG5cbiAgICAvKiAgJ215dXNlcmluZG9ja2VyL2RlcGxveW1lbnQtZW52aXJvbm1lbnQ6bGF0ZXN0J1xuICAgICAgICAnbXl1c2VyaW5kb2NrZXIvZGVwbG95bWVudC1lbnZpcm9ubWVudDpzaW1wbGVfTm9kZURvY2tlckNvbXBvc2UnXG4gICAgICAgIHRoaXMgY29udGFpbmVyIHNob3VsZCBoYXZlIGRvY2tlciBjbGllbnQgJiBkb2NrZXItY29tcG9zZSBpbnN0YWxsZWQgaW4uKi9cbiAgICBgJHtkb2NrZXJEZXBsb3ltZW50SW1hZ2V9YCxcbiAgICBzY3JpcHRDb21tYW5kLFxuICBdXG5cbiAgY29uc29sZS5sb2coJ2NvbnRhaW5lciBjb21tYW5kJyArICc6IFxcbicsIHNjcmlwdENvbW1hbmQpXG4gIGNvbnNvbGUubG9nKGDigKIgZG9ja2VyIGNvbW1hbmQ6IFwiJHtleGVjdXRhYmxlQ29tbWFuZC5qb2luKCcgJyl9XCJgKVxuXG4gIGxldCBvcHRpb24gPSB7XG4gICAgY3dkOiByb290UGF0aCxcbiAgICBkZXRhY2hlZDogZmFsc2UsXG4gICAgc2hlbGw6IHRydWUsXG4gICAgc3RkaW86IFswLCAxLCAyXSxcbiAgICAvLyBJTVBPUlRBTlQ6IGdsb2JhbCBlbnZpcm9ubWVudCBzaG91bGQgYmUgcGFzc2VkIHRvIGFsbG93IGZvciBkb2NrZXIgY29tbWFuZHMgdG8gd29yayBpbnNpZGUgbm9kZWpzIHByb2Nlc3MsIGFzIHRoZSBXU0wgdXNlcyBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSB0byBjb25uZWN0IHRvIHRoZSBXaW5kb3dzIERvY2tlciBlbmdpbmUgc29ja2V0LlxuICAgIGVudjogT2JqZWN0LmFzc2lnbih7fSwgcHJvY2Vzcy5lbnYsIHtcbiAgICAgIC8vIERFUExPWU1FTlQ6ICdkZXZlbG9wbWVudCcsXG4gICAgfSksXG4gIH1cbiAgY29uc3QgW2NvbW1hbmQsIC4uLmNvbW1hbmRBcmd1bWVudF0gPSBleGVjdXRhYmxlQ29tbWFuZFxuICBzcGF3blN5bmMoY29tbWFuZCwgY29tbWFuZEFyZ3VtZW50LCBvcHRpb24pXG59XG5cbi8vIGNvbXBvc2Ugb3B0aW9ucyBodHRwczovL2RvY3MuZG9ja2VyLmNvbS9jb21wb3NlL2NvbXBvc2UtZmlsZS8jZW50cnlwb2ludFxuLy8gY29tcG9zZSBjb21tYW5kIG9wdGlvbnMgaHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9yZWZlcmVuY2Uvb3ZlcnZpZXcvXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZG9ja2VyQ29tcG9zZUNsaSh7IGFwaSAvKiBzdXBwbGllZCBieSBzY3JpcHRNYW5hZ2VyICovLCBzY3JpcHRDb21tYW5kID0gJy9iaW4vYmFzaCcgfSA9IHt9KSB7XG4gIGNvbnN0IHRhcmdldFByb2plY3RDb25mID0gYXBpLnByb2plY3QuY29uZmlndXJhdGlvbi5jb25maWd1cmF0aW9uLFxuICAgIHJvb3RQYXRoID0gYXBpLnByb2plY3QuY29uZmlndXJhdGlvbi5yb290UGF0aCxcbiAgICB0YXJnZXRUZW1wb3JhcnlGb2xkZXIgPSBwYXRoLmpvaW4ocm9vdFBhdGgsICd0ZW1wb3JhcnknKSxcbiAgICBjb250YWluZXJQcm9qZWN0UGF0aCA9IHJvb3RQYXRoXG5cbiAgYXdhaXQgY3JlYXRlRGlyZWN0b3J5UmVjdXJzaXZlKHRhcmdldFRlbXBvcmFyeUZvbGRlcilcblxuICBsZXQgb3B0aW9uID0ge1xuICAgIGN3ZDogcm9vdFBhdGgsXG4gICAgZGV0YWNoZWQ6IGZhbHNlLFxuICAgIHNoZWxsOiB0cnVlLFxuICAgIHN0ZGlvOiBbMCwgMSwgMl0sXG4gICAgLy8gSU1QT1JUQU5UOiBnbG9iYWwgZW52aXJvbm1lbnQgc2hvdWxkIGJlIHBhc3NlZCB0byBhbGxvdyBmb3IgZG9ja2VyIGNvbW1hbmRzIHRvIHdvcmsgaW5zaWRlIG5vZGVqcyBwcm9jZXNzLCBhcyB0aGUgV1NMIHVzZXMgYW4gZW52aXJvbm1lbnQgdmFyaWFibGUgdG8gY29ubmVjdCB0byB0aGUgV2luZG93cyBEb2NrZXIgZW5naW5lIHNvY2tldC5cbiAgICBlbnY6IE9iamVjdC5hc3NpZ24oe30sIHByb2Nlc3MuZW52LCB7XG4gICAgICAvLyBERVBMT1lNRU5UOiAnZGV2ZWxvcG1lbnQnLFxuICAgIH0pLFxuICB9XG5cbiAgbGV0IHBvcnRMaXN0ID0gW1xuICAgIC4uLnRhcmdldFByb2plY3RDb25mLmFwaUdhdGV3YXkuc2VydmljZS5tYXAoaXRlbSA9PiBpdGVtLnBvcnQpLmZpbHRlcihpdGVtID0+IGl0ZW0pLFxuICAgIC8vIEFkZGl0aW9uYWwgZGV2ZWxvcG1lbnQgcG9ydHNcbiAgICAuLi5bXG4gICAgICAvLyBOb2RlanMncyByZW1vdGUgZGVidWdnZXJcbiAgICAgIDkyMjksXG4gICAgICAvLyBCcm93c2Vyc3luYyBsaXZlcmVsb2FkXG4gICAgICA5MDkwLFxuICAgICAgOTkwMSxcbiAgICAgIDk5MDIsXG4gICAgXSxcbiAgXVxuICBsZXQgc2VydmljZUNvbmZpZyA9IHtcbiAgICB2ZXJzaW9uOiAnMy43JyxcblxuICAgIG5ldHdvcmtzOiB7XG4gICAgICBpbnRlcm5hbDoge1xuICAgICAgICBkcml2ZXI6ICdicmlkZ2UnLCAvLyBuZXR3b3JrIGRpcnZlcjogIGJyaWRnZSBmb3IgdGhlIHNhbWUgaG9zdCwgd2hpbGUgb3ZlcmxheSBpcyBmb3Igc3dhcm0gaG9zdHMuXG4gICAgICB9LFxuICAgIH0sXG5cbiAgICBzZXJ2aWNlczoge1xuICAgICAgYXBwbGljYXRpb246IHtcbiAgICAgICAgaW1hZ2U6IGRvY2tlckRlcGxveW1lbnRJbWFnZSxcblxuICAgICAgICAvLyBleHBvcnQgcG9ydHMgdG8gaG9zdCBtYWNoaW5lOlxuICAgICAgICAvLyB0byBjaGFuZ2UgcG9ydCBpbnRlcmZhY2UgKGlwKSB1c2UgXCIxMjcuMC4wLjE6ODA6ODBcIlxuICAgICAgICBwb3J0czogcG9ydExpc3QubWFwKHBvcnQgPT4ge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0YXJnZXQ6IHBvcnQsXG4gICAgICAgICAgICBwdWJsaXNoZWQ6IHBvcnQsXG4gICAgICAgICAgICAvLyBtb2RlOiAnaG9zdCcsXG4gICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBuZXR3b3Jrczoge1xuICAgICAgICAgIGludGVybmFsOiB7XG4gICAgICAgICAgICBhbGlhc2VzOiBbJ2FwcGxpY2F0aW9uJ10sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcblxuICAgICAgICB2b2x1bWVzOiBbXG4gICAgICAgICAgYCR7cm9vdFBhdGh9OiR7Y29udGFpbmVyUHJvamVjdFBhdGh9YCxcbiAgICAgICAgICAvLyBsb2NhbCBkZXZlbG9wbWVudCByZWxhdGVkIHBhdGhzXG4gICAgICAgICAgYCR7ZGV2ZWxvcG1lbnRDb2RlRm9sZGVyfToke2RldmVsb3BtZW50Q29kZUZvbGRlcn1gLFxuICAgICAgICAgIGAke3lhcm5MaW5rRm9scmRlcn06JHt5YXJuTGlua0ZvbHJkZXJ9YCxcbiAgICAgICAgICBgL3Zhci9ydW4vZG9ja2VyLnNvY2s6L3Zhci9ydW4vZG9ja2VyLnNvY2tgLFxuXG4gICAgICAgICAgLy8gYWxsb3cgZm9yIHVzaW5nIGxvY2FsIHVzZXIgbmFtZSAob2YgaG9zdCBtYWNoaW5lKSB0byB3cml0ZSBmaWxlcyBhbmQgcGVybWlzc2lvbnMgdGhyb3VnaCB0aGUgZG9ja2VyIGNvbnRhaW5lci4gaHR0cHM6Ly9tZWRpdW0uY29tL2ZhdW4vc2V0LWN1cnJlbnQtaG9zdC11c2VyLWZvci1kb2NrZXItY29udGFpbmVyLTRlNTIxY2VmOWZmY1xuICAgICAgICAgIGAvZXRjL3Bhc3N3ZDovZXRjL3Bhc3N3ZDpyb2AsXG4gICAgICAgICAgYC9ldGMvZ3JvdXA6L2V0Yy9ncm91cDpyb2AsXG4gICAgICAgICAgYC9ldGMvc2hhZG93Oi9ldGMvc2hhZG93OnJvYCxcbiAgICAgICAgXSxcblxuICAgICAgICB1c2VyOiBgJHtvcGVyYXRpbmdTeXN0ZW0udXNlckluZm8oKS51aWR9OiR7b3BlcmF0aW5nU3lzdGVtLnVzZXJJbmZvKCkuZ2lkfWAsIC8vIHVpZDpnaWRcbiAgICAgICAgd29ya2luZ19kaXI6IHJvb3RQYXRoLFxuICAgICAgICAvLyBJTVBPUlRBTlQ6IGlmIGV4ZWN1dGVkIHdpdGggY29tbWFuZCBgL2Jpbi9zaCAtYyAnJ2AsIGFzIGRlZmF1bHQgZG9ja2VyIGRvZXMsIHRoZSBpbnRlcnJ1cHQgc2lnbmFscyB3aWxsIG5vdCBiZSBwYXNzZWQgdG8gdGhlIHJ1bm5pbmcgcHJvY2VzcyBhbmQgdGh1cyB3aWxsIG5vdCBhYm9ydCB0aGUgY29udGFpbmVycy4gVGhlcmVmb3JlIC9iaW4vYmFzaCAtYyBzaG91bGQgYmUgdXNlZCwgb3IgRU5UUllQT0lOVCBpbnN0ZWFkIG9mIENPTU1BTkQgd2lsbCB1c2UgYmFzaCBieSBkZWZhdWx0LlxuICAgICAgICAvLyBJTVBPUlRBTlQ6IG5vZGUgLS1ldmFsIGRvZXNuJ3QgcGFzcyBzaWduYWxzIGNvcnJlY3RseSBpbiBkb2NrZXIgY29tbWFuZCwgYnV0IHdyYXBwaW5nIGl0IHRocm91Z2ggbnBtIHNjcmlwdHMgKHlhcm4gcnVuIDxzY3JpcHQgbmFtZT4pIGFkZHMgZnVuY3Rpb25hbGl0eS5cbiAgICAgICAgY29tbWFuZDogc2NyaXB0Q29tbWFuZCxcbiAgICAgICAgLy8gZW50cnlwb2ludDpcbiAgICAgICAgLy8gICAvLyBbJ25vZGUnLCBgLS1ldmFsYCwgYHJlcXVpcmUocHJvY2Vzcy5jd2QoKSkuYXBwbGljYXRpb24oe30se21lbWdyYXBoOntob3N0OidtZW1ncmFwaCd9fSlgXSB8fCBbJ3lhcm4nLCAncnVuJywgJ3J1bi1jb25maWd1cmVkRm9yQ29udGFpbmVyJ10gfHxcbiAgICAgICAgLy8gICBgJHtzY3JpcHRDb21tYW5kfWAuc3BsaXQoJyAnKS5maWx0ZXIoaXRlbSA9PiBpdGVtLmxlbmd0aCAvKlJlbW92ZSBlbXB0eSB2YWx1ZXMqLyksIC8vIGAvYmluL2Jhc2ggLWMgXCJscyAtYWxcImBcblxuICAgICAgICAvLyBodHRwczovL2RvY3MuZG9ja2VyLmNvbS9jb21wb3NlL2NvbXBvc2UtZmlsZS8jZG9tYWlubmFtZS1ob3N0bmFtZS1pcGMtbWFjX2FkZHJlc3MtcHJpdmlsZWdlZC1yZWFkX29ubHktc2htX3NpemUtc3RkaW5fb3Blbi10dHktdXNlci13b3JraW5nX2RpclxuICAgICAgICAvLyB3b3JrcyBvbmx5IHdpdGggZG9ja2VyLWNvbXBvc2UgcnVuIGJ1dCBkb2Vzbid0IHdvcmsgZm9yIHNvbWUgcmVhc29uIHdpdGggZG9ja2VyLWNvbXBvc2UgdXAgKHN0dWNrIG9uICdhdHRhY2hpbmcgPHNlcnZpY2VOYW1lPi4uJylcbiAgICAgICAgdHR5OiB0cnVlLFxuICAgICAgICBzdGRpbl9vcGVuOiB0cnVlLFxuICAgICAgfSxcblxuICAgICAgbWVtZ3JhcGg6IHtcbiAgICAgICAgaW1hZ2U6ICdtZW1ncmFwaDpsYXRlc3QnLFxuXG4gICAgICAgIC8vIGV4cG9ydCBwb3J0cyB0byBob3N0IG1hY2hpbmU6XG4gICAgICAgIHBvcnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGFyZ2V0OiA3Njg3LFxuICAgICAgICAgICAgLy8gcHVibGlzaGVkOiA3Njg3LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG5cbiAgICAgICAgbmV0d29ya3M6IHtcbiAgICAgICAgICBpbnRlcm5hbDoge1xuICAgICAgICAgICAgYWxpYXNlczogWydtZW1ncmFwaCddLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH1cblxuICAvLyBjb252ZXJ0IHNlcnZpY2UgY29uZmlndXJhdGlvbiBpbnRvIHlhbWwgZmlsZSBpbiB0ZW1wb3JhcnkgbG9jYXRpb24sIHRvIGJlIHVzZWQgbGF0ZXIgd2l0aCBkb2NrZXItY29tcG9zZS5cbiAgbGV0IHlhbWxGaWxlID0gcGF0aC5qb2luKHRhcmdldFRlbXBvcmFyeUZvbGRlciwgJ2RvY2tlckNvbXBvc2UueWFtbCcpXG4gIGZpbGVzeXN0ZW0ud3JpdGVGaWxlU3luYyh5YW1sRmlsZSwganNZYW1sLmR1bXAoc2VydmljZUNvbmZpZywgeyBsaW5lV2lkdGg6IEluZmluaXR5LCBub0NvbXBhdE1vZGU6IHRydWUgfSkpXG5cbiAgbGV0IGRvY2tlckNvbXBvc2VDb21tYW5kID0gYGRvY2tlci1jb21wb3NlIC0tZmlsZSAke3lhbWxGaWxlfSAtLXByb2plY3QtbmFtZSB3ZWJhcHBQcm9qZWN0IC0tbG9nLWxldmVsIElORk9gXG5cbiAge1xuICAgIC8vIE5vdGU6IG5lY2Vzc2FyeSBzdGVwIGFzIHJlY3JlYXRpbmcgc2VydmljZXMgd2lsbCB1c2UgcHJldmlvdXNseSBjcmVhdGVkIHZvbHVtZXMgKGUuZy4gZGF0YWJhc2UgYW5vbnltb3VzIHZvbHVtZSlcbiAgICAvLyBzdG9wIGFuZCByZW1vdmUgY29udGFpbmVycyBhbmQgdm9sdW1lcyByZWxhdGVkIHRvIHByb2plY3QgbmFtZSBmcm9tIHByZXZpb3VzIHJ1bm5pbmdcbiAgICBsZXQgZXhlY3V0YWJsZUNvbW1hbmQgPSBbXG4gICAgICBbXG4gICAgICAgIGRvY2tlckNvbXBvc2VDb21tYW5kLFxuICAgICAgICAnZG93biAtLXZvbHVtZXMnLCAvLyByZW1vdmUgdm9sdW1lcyBhdHRhY2hlZCB0byBjb250YWluZXJzLlxuICAgICAgXS5qb2luKCcgJyksXG4gICAgXVxuICAgIGNvbnN0IFtjb21tYW5kLCAuLi5jb21tYW5kQXJndW1lbnRdID0gZXhlY3V0YWJsZUNvbW1hbmRcbiAgICBzcGF3blN5bmMoY29tbWFuZCwgY29tbWFuZEFyZ3VtZW50LCBvcHRpb24pXG4gIH1cblxuICBsZXQgZXhlY3V0YWJsZUNvbW1hbmQgPSBbXG4gICAgW1xuICAgICAgZG9ja2VyQ29tcG9zZUNvbW1hbmQsXG5cbiAgICAgIC8vIHJ1bjogYWxsb3dzIGF0dGFjaGluZyB0byB0aGUgY29udGFpbmVyXG4gICAgICAvLyBzZXJ2aWNlLXBvcnRzIGFsbG93cyBtYXBwaW5nIG9mIHBvcnRzIHRvIGhvc3QgYXMgc2V0IGluIHltbCBmaWxlLlxuICAgICAgLy8gYHJ1biAtLXJtIC0tc2VydmljZS1wb3J0cyAtLXVzZS1hbGlhc2VzIGFwcGxpY2F0aW9uYCxcblxuICAgICAgLy8gdXBcbiAgICAgIC8vIC0tZGV0YWNoXG4gICAgICBgdXAgLS1uby1idWlsZCAtLWZvcmNlLXJlY3JlYXRlIC0tYWJvcnQtb24tY29udGFpbmVyLWV4aXQgLS1hbHdheXMtcmVjcmVhdGUtZGVwc2AsXG4gICAgXS5qb2luKCcgJyksXG4gIF1cblxuICBjb25zb2xlLmxvZygnY29udGFpbmVyIGNvbW1hbmQnICsgJzogXFxuJywgc2NyaXB0Q29tbWFuZClcbiAgY29uc29sZS5sb2coYOKAoiBkb2NrZXIgY29tbWFuZDogXCIke2V4ZWN1dGFibGVDb21tYW5kLmpvaW4oJyAnKX1cImApXG4gIGNvbnN0IFtjb21tYW5kLCAuLi5jb21tYW5kQXJndW1lbnRdID0gZXhlY3V0YWJsZUNvbW1hbmRcbiAgc3Bhd25TeW5jKGNvbW1hbmQsIGNvbW1hbmRBcmd1bWVudCwgb3B0aW9uKVxuXG4gIC8vIGRvd246IGFsbG93cyB0byByZW1vdmUgY29udGFpbmVycyBpbiBhZGRpdGlvbiB0byBzdG9wcGluZyB0aGVtLlxuICAvLyBUT0RPOiBEb2Vzbid0IHdvcmssIHNlZW1zIHJlbGF0ZWQgdG8gdGhlIHNpZ25hbCB0cmFuc21pdGlvbiB0byB0aGUgcHJvY2VzcyB0aHJvdWdoIGNvbnRhaW5lciBjb21tYW5kcy5cbiAgcHJvY2Vzcy5vbignU0lHSU5UJywgKGNvZGUsIHNpZ25hbCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBbUHJvY2VzcyAke3Byb2Nlc3MucGlkfV06IHNpZ25hbCAke3NpZ25hbH0sIGNvZGUgJHtjb2RlfTtgKVxuICAgIC8vIHN0b3AgYW5kIHJlbW92ZSBjb250YWluZXJzIHJlbGF0ZWQgdG8gcHJvamVjdCBuYW1lLlxuICAgIGxldCBleGVjdXRhYmxlQ29tbWFuZCA9IFtcbiAgICAgIFtcbiAgICAgICAgZG9ja2VyQ29tcG9zZUNvbW1hbmQsXG4gICAgICAgICdkb3duJyxcbiAgICAgICAgLy8gLS12b2x1bWVzIC8vcmVtb3ZlIHZvbHVtZXMgYXR0YWNoZWQgdG8gY29udGFpbmVycy5cbiAgICAgIF0uam9pbignICcpLFxuICAgIF1cbiAgICBjb25zdCBbY29tbWFuZCwgLi4uY29tbWFuZEFyZ3VtZW50XSA9IGV4ZWN1dGFibGVDb21tYW5kXG4gICAgc3Bhd25TeW5jKGNvbW1hbmQsIGNvbW1hbmRBcmd1bWVudCwgb3B0aW9uKVxuICB9KVxufVxuIl19